{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst crypto_1 = __importDefault(require(\"crypto\"));\n\nconst rxjs_1 = require(\"rxjs\");\n\nconst operators_1 = require(\"rxjs/operators\");\n\nconst STORAGE_KEY_SESSION_ID = \"session:id\";\nconst STORAGE_KEY_SESSION_SECRET = \"session:secret\";\nconst STORAGE_KEY_SESSION_LINKED = \"session:linked\";\n\nclass Session {\n  constructor(storage, id, secret, linked) {\n    this._storage = storage;\n    this._id = id || crypto_1.default.randomBytes(16).toString(\"hex\");\n    this._secret = secret || crypto_1.default.randomBytes(32).toString(\"hex\");\n    this._key = crypto_1.default.createHash(\"sha256\").update(`${this._id}, ${this._secret} WalletLink`, \"ascii\").digest(\"hex\");\n    this._linked = !!linked;\n  }\n\n  static load(storage) {\n    const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n    const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n    const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n\n    if (id && secret) {\n      return new Session(storage, id, secret, linked === \"1\");\n    }\n\n    return null;\n  }\n\n  static clear(storage) {\n    storage.removeItem(STORAGE_KEY_SESSION_SECRET);\n    storage.removeItem(STORAGE_KEY_SESSION_ID);\n    storage.removeItem(STORAGE_KEY_SESSION_LINKED);\n  }\n\n  static get persistedSessionIdChange$() {\n    return rxjs_1.fromEvent(window, \"storage\").pipe(operators_1.filter(evt => evt.key === STORAGE_KEY_SESSION_ID), operators_1.map(evt => ({\n      oldValue: evt.oldValue || null,\n      newValue: evt.newValue || null\n    })));\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get secret() {\n    return this._secret;\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  get linked() {\n    return this._linked;\n  }\n\n  set linked(val) {\n    this._linked = val;\n    this.persistLinked();\n  }\n\n  save() {\n    this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n\n    this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n\n    this.persistLinked();\n    return this;\n  }\n\n  persistLinked() {\n    this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\n  }\n\n}\n\nexports.Session = Session;","map":{"version":3,"sources":["/home/ryann/Documents/Repos/ChainSafe/chainbridge-ui/node_modules/walletlink/dist/relay/Session.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","crypto_1","require","rxjs_1","operators_1","STORAGE_KEY_SESSION_ID","STORAGE_KEY_SESSION_SECRET","STORAGE_KEY_SESSION_LINKED","Session","constructor","storage","id","secret","linked","_storage","_id","default","randomBytes","toString","_secret","_key","createHash","update","digest","_linked","load","getItem","clear","removeItem","persistedSessionIdChange$","fromEvent","window","pipe","filter","evt","key","map","oldValue","newValue","val","persistLinked","save","setItem"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst crypto_1 = __importDefault(require(\"crypto\"));\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst STORAGE_KEY_SESSION_ID = \"session:id\";\nconst STORAGE_KEY_SESSION_SECRET = \"session:secret\";\nconst STORAGE_KEY_SESSION_LINKED = \"session:linked\";\nclass Session {\n    constructor(storage, id, secret, linked) {\n        this._storage = storage;\n        this._id = id || crypto_1.default.randomBytes(16).toString(\"hex\");\n        this._secret = secret || crypto_1.default.randomBytes(32).toString(\"hex\");\n        this._key = crypto_1.default\n            .createHash(\"sha256\")\n            .update(`${this._id}, ${this._secret} WalletLink`, \"ascii\")\n            .digest(\"hex\");\n        this._linked = !!linked;\n    }\n    static load(storage) {\n        const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n        const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n        const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n        if (id && secret) {\n            return new Session(storage, id, secret, linked === \"1\");\n        }\n        return null;\n    }\n    static clear(storage) {\n        storage.removeItem(STORAGE_KEY_SESSION_SECRET);\n        storage.removeItem(STORAGE_KEY_SESSION_ID);\n        storage.removeItem(STORAGE_KEY_SESSION_LINKED);\n    }\n    static get persistedSessionIdChange$() {\n        return rxjs_1.fromEvent(window, \"storage\").pipe(operators_1.filter(evt => evt.key === STORAGE_KEY_SESSION_ID), operators_1.map(evt => ({\n            oldValue: evt.oldValue || null,\n            newValue: evt.newValue || null\n        })));\n    }\n    get id() {\n        return this._id;\n    }\n    get secret() {\n        return this._secret;\n    }\n    get key() {\n        return this._key;\n    }\n    get linked() {\n        return this._linked;\n    }\n    set linked(val) {\n        this._linked = val;\n        this.persistLinked();\n    }\n    save() {\n        this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n        this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n        this.persistLinked();\n        return this;\n    }\n    persistLinked() {\n        this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\n    }\n}\nexports.Session = Session;\n"]},"metadata":{},"sourceType":"script"}