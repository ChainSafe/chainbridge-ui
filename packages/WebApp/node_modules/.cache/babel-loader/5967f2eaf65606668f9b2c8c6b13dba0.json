{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = _interopRequireWildcard(require(\"../../utils/debug\"));\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.init)('[trezor-connect.js]');\n\nvar _settings;\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)({\n    manifest: data\n  });\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  iframe.dispose();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            if (!_settings) {\n              _settings = (0, _ConnectSettings.parse)(settings);\n            }\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            } // reset \"lazyLoad\" after first use\n\n\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            } // init popup with lazy loading before iframe initialization\n\n\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 19:\n            if (!iframe.error) {\n              _context2.next = 21;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 21:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 22;\n            _context2.next = 25;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 25:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 31;\n              break;\n            }\n\n            if (!response.success && response.payload.error.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 31:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 33:\n            _context2.next = 40;\n            break;\n\n          case 35:\n            _context2.prev = 35;\n            _context2.t1 = _context2[\"catch\"](22);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 40:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [22, 35]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n    return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (iframe.instance) {\n              _context3.next = 2;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n\n          case 2:\n            _context3.next = 4;\n            return call({\n              method: 'getSettings'\n            });\n\n          case 4:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getSettings() {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            if (!(typeof params.callback !== 'function')) {\n              _context5.next = 2;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 2:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context4.next = 6;\n                          break;\n                        }\n\n                        _context4.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context4.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref5.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context5.next = 7;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 7:\n            response = _context5.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context5.abrupt(\"return\", response);\n\n          case 10:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            if (!(typeof params.callback === 'function')) {\n              _context7.next = 11;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref7 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n                  while (1) {\n                    switch (_context6.prev = _context6.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context6.next = 12;\n                          break;\n                        }\n\n                        _context6.prev = 2;\n                        _context6.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context6.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context6.next = 12;\n                        break;\n\n                      case 9:\n                        _context6.prev = 9;\n                        _context6.t0 = _context6[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context6.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context6.stop();\n                    }\n                  }\n                }, _callee6, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref7.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context7.next = 6;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 6:\n            response = _context7.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context7.abrupt(\"return\", response);\n\n          case 11:\n            _context7.next = 13;\n            return call(_objectSpread({\n              method: 'requestLogin'\n            }, params));\n\n          case 13:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 14:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;","map":{"version":3,"sources":["/home/ryann/Documents/Repos/ChainSafe/chainbridge-ui/node_modules/trezor-connect/lib/env/browser/index.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","exports","__esModule","disableWebUSB","requestLogin","customMessage","getSettings","renderWebUSBButton","uiResponse","call","init","cancel","dispose","manifest","eventEmitter","_defineProperty2","_regenerator","_asyncToGenerator2","_events","_PopupManager","iframe","_button","_message","_builder2","_ConnectSettings","_debug","_constants","$T","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","_log","_settings","_popupManager","initPopupManager","pm","on","POPUP","CLOSED","error","postMessage","type","payload","data","parse","close","emit","handleMessage","messageEvent","origin","message","parseMessage","event","id","log","RESPONSE_EVENT","messagePromises","resolve","success","warn","DEVICE_EVENT","TRANSPORT_EVENT","BLOCKCHAIN_EVENT","UI_EVENT","IFRAME","BOOTSTRAP","clearTimeout","LOADED","initPromise","ERROR","reject","_ref","mark","_callee","settings","wrap","_callee$","_context","prev","next","instance","ERRORS","TypedError","lazyLoad","abrupt","enabled","debug","window","addEventListener","stop","_x","_ref2","_callee2","params","response","_callee2$","_context2","timeout","errorMessage","request","t0","includes","code","UiMessage","UI","IFRAME_FAILURE","popup","CALL","sent","unlock","t1","_x2","customMessageResponse","CUSTOM_MESSAGE_RESPONSE","className","webusbSrc","_ref3","_callee3","_callee3$","_context3","method","_ref4","_callee5","callback","customMessageListener","_callee5$","_context5","_ref5","_callee4","_callee4$","_context4","CUSTOM_MESSAGE_REQUEST","_x4","removeEventListener","_x3","_ref6","_callee7","loginChallengeListener","_callee7$","_context7","_ref7","_callee6","_callee6$","_context6","LOGIN_CHALLENGE_REQUEST","LOGIN_CHALLENGE_RESPONSE","_x6","asyncChallenge","_x5","TRANSPORT","DISABLE_WEBUSB"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = _interopRequireWildcard(require(\"../../utils/debug\"));\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.init)('[trezor-connect.js]');\n\nvar _settings;\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)({\n    manifest: data\n  });\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  iframe.dispose();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            if (!_settings) {\n              _settings = (0, _ConnectSettings.parse)(settings);\n            }\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            }\n\n            // reset \"lazyLoad\" after first use\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            }\n\n            // init popup with lazy loading before iframe initialization\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 19:\n            if (!iframe.error) {\n              _context2.next = 21;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 21:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 22;\n            _context2.next = 25;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 25:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 31;\n              break;\n            }\n\n            if (!response.success && response.payload.error.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 31:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 33:\n            _context2.next = 40;\n            break;\n\n          case 35:\n            _context2.prev = 35;\n            _context2.t1 = _context2[\"catch\"](22);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 40:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [22, 35]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n    return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (iframe.instance) {\n              _context3.next = 2;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n\n          case 2:\n            _context3.next = 4;\n            return call({\n              method: 'getSettings'\n            });\n\n          case 4:\n            return _context3.abrupt(\"return\", _context3.sent);\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getSettings() {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            if (!(typeof params.callback !== 'function')) {\n              _context5.next = 2;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 2:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context4.next = 6;\n                          break;\n                        }\n\n                        _context4.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context4.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref5.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context5.next = 7;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 7:\n            response = _context5.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context5.abrupt(\"return\", response);\n\n          case 10:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            if (!(typeof params.callback === 'function')) {\n              _context7.next = 11;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref7 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n                  while (1) {\n                    switch (_context6.prev = _context6.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context6.next = 12;\n                          break;\n                        }\n\n                        _context6.prev = 2;\n                        _context6.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context6.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context6.next = 12;\n                        break;\n\n                      case 9:\n                        _context6.prev = 9;\n                        _context6.t0 = _context6[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context6.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context6.stop();\n                    }\n                  }\n                }, _callee6, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref7.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context7.next = 6;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 6:\n            response = _context7.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context7.abrupt(\"return\", response);\n\n          case 11:\n            _context7.next = 13;\n            return call(_objectSpread({\n              method: 'requestLogin'\n            }, params));\n\n          case 13:\n            return _context7.abrupt(\"return\", _context7.sent);\n\n          case 14:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;"]},"metadata":{},"sourceType":"script"}